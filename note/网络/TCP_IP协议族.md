# TCP/IP协议族
TCP/IP其实并非就只是指TCP和IP这两个协议,而是指与其相关的各种协议.如:HTTP,FTP,DNS,TCP,UDP,IP,SNMP等等,都属于TCP/IP协议族的范畴.

## TCP/IP协议的分层
1. OSI模型

    TCP/IP协议族是分层管理的, 在OSI模型中可以分为7层(应用层,表示层,会话层,传输层,网络层,数据链路层,物理层, 简记为`应表会传网数物`).
    - 应用层    (HTTP)
    - 表示层    负责数据压缩,解压,加密,解密
    - 会话层    (SSL/TLS)
    - 传输层    (TCP, 报文)
    - 网络层    (IPv4, 由帧组成的数据包)  
    - 数据链路层 (传输数据帧, 协议: 以太网)
    - 物理层    (传输物理信号/bit), 协议: 网络电缆/ wifi)
2. TCP/IP模型

    但是OSI模型的分层粒度太细了,我们又可以根据对于TCP / IP模型把它分为四层(应用层, 传输层, 网络层, 链路层). 下面对每一层简单介绍一下:
    >- `应用层`: 这是面向用户的一层,用户是可以直接操作该层的.我们常见的`HTTP(HyperText Transfer Protocol:超文本传输协议)`, `FTP(File Transfer Protocol:文件传输协议)`和`DNS(Domain Name System: 域名系统)`都属于应用层, 在OSI模型中, 这一层又可以分为`应用层,表示层,会话层`. 这一层决定了向用户提供应用服务时的通信活动.
    >
    >- `传输层`: 应用层会将数据交给传输层进行传输. `TCP(Transmission Control Protocol: 传输控制协议)`和`UDP(User Data Protocol:用户数据报协议)`位于这一层. TCP建立连接时需要三次握手来确认连接情况, 断开连接时需要四次挥手才能安全断开. 而UDP不需要这些过程.这一层是用来提供处于网络连接中的两台计算机直接的数据传输.
    >
    >- `网络层`:网络层是用来处理网络上流动的数据包, `IP(Internet Protocol:网际协议)`就是位于这一层. 该层负责在总舵网络线路中选择一条传输线路, 期间需要IP地址和MAC地址的支持.  
    ps: ARP协议是根据IP获得MAC地址的协议, 恶意伪造MAC地址,可能造成局域网广播灾难.
    >
    >- `链路层`: 链路层主要用来处理网络的硬件部分, 在OSI模型中这一层又分为`数据链路层和物理层`. 网卡与光纤就是数据这一层的.

    简单的封包/解包过程如下图:
    ![pic_01](../../pic/tcp_ip_01.png)



## TCP

### 常见场景
FTP,HTTP协议的传输层协议, 收发邮件, 远程登录等准确性要求高的场景

### 特点

1. 需要连接(`三次握手`)
2. 数据不丢失,不重复,按序到达
3. 只支持1对1通信

### 三次握手
为了确保传输的可靠性,TCP在建立连接时需要三次握手.
> 1. 第一次握手: 发送端发送一个带`SYN(Synchronize:同步)`标记的数据报给接收端, 用于询问接收端是否可以接受, 如果可以,就进入第二次握手.
>
> 2. 第二次握手: 接收端回传给发送端一个带有`SYN/ACK(Acknowledgement:确认)`的数据包, 给发送端说, 我收到你给我发送的SYNC标记了, 我再给你传一个ACK标志.如果发送端收到了`SYN/ACK`这个数据报,就可以确认接收端收到了之前发送的SYN包, 然后可以进入第三次握手.
>
> 3. 第三次握手: 发送端会给接收端发送一个带有`ACK + 1`标志的数据报, 告诉接收端我也收到你给我发送的`SYN/ACK`标志了.接收端如果收到了这个来着发送端的ACK标志,三次握手就完成,连接成功建立.

![pic_02](../../pic/tcp_ip_02.png)

### 四次挥手
为了确保传输的可靠性,TCP在关闭连接的时候需要四次挥手来确保数据传输完整.
> 1. 第一次挥手: 客户端发送一个`FIN(Finsh)`数据包, 用来关闭客户端到服务器的数据传输
>
> 2. 第二次挥手: 服务器收到这个`FIN`包, 它会发回一个`ACK + 1`, 确认序号为收到的序号加1.
>
> 3. 第三次挥手: 服务器关闭客户端的连接, 发送一个`FIN`包给客户端.
>
> 4. 第四次挥手: 客户端发回`ACK + 1`数据包确认, 并将确认序号设置为收到序号加1

![pic_03](../../pic/tcp_ip_03.png)

## UDP

### 常见场景
即时聊天(QQ), 在线视频, 大型多人在线游戏 等高实时性要求的场景

### 特点

1. `无连接`协议, 发送数据之前不需要建立连接
2. 不保证不会丢包
3. 支持n对n的交互通信
4. 实时性好, 工作效率高, 系统资源要求少



## 参考
[面试官，不要再问我三次握手和四次挥手](https://blog.csdn.net/hyg0811/article/details/102366854)