# 重构的原则

## 什么是重构
软件内部的结构调整, 不改变软件可观察行为的前提下,提高其可理解性, 降低其修改成本.

## 为什么要重构
1. 改进软件的设计  
    开发期间常常为了快速开发, 导致代码失去原来的设计结构, 导致大量重复代码
2. 使软件更容易理解  
    提高代码的可读性, 梳理逻辑使其便于理解
3. 帮助找bug  

4. 提高后续编程速度

## 什么时候重构
1. 当可以使新功能更容易添加时
2. 当时代码更容易懂时
3. 当发现很明显的辣鸡代码时
4. code review时

## 什么时候不要重构
1. 当丑陋的代码被一个api封装起来且不需要修改它时
2. 重写比重构更简单时

## 重构的挑战
1. 需要花费时间重构, 延缓新功能开发
2. 影响代码的所有权, 可能会修改到别人编写的代码
3. 分支merge/rebase的间隔不宜过长,需要控制分支稳定性
4. TDD, 需要预先编写好完善的测试
5. 重构遗留代码时可以每次只重构用到的那部分代码, 每次都变好一点点
6. 重构数据库, 可以分多步重构, 增加字段 - 并存字段 - 删除字段

## 重构与性能
对性能有要要求的软件编写方法有3种:
1. 时间预算法: 把软件运行时间控制在一定范围内
2. 持续关注法: 时刻关注编写的每一部分代码的性能
3. 统计法: 统计消耗大量时间的代码(通常是小部分代码), 着重对它优化

个人认为良好的代码编写方法是: 先以良好的代码结构编写代码, 先使代码易读易懂易扩展, 不需要过度考虑性能, 待性能成为瓶颈时, 因为对良好易读的代码进行性能调优也是相对容易的.

## 自动化重构
大多数静态语言的IDE工具都有支持自动化重构的工具.  
大概原理: 
1. 分析静态语言的语法树
2. 把修改的函数名/变量名同步到整个语法树上
3. 再根据语法树把修改后的代码输出到对应的文件中